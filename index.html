<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lunacy</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <!-- Row 1: Branding (Logo + Wordmark) -->
    <div class="topbarRow brandRow" aria-label="Lunacy">
      <div class="brand">
        <img src="logo.png" class="logoImg" alt="Lunacy Logo" />
        <div class="brandRight">
          <img src="lunacy-wordmark.png" class="logoWordmark" alt="Lunacy" />
          <div class="brandSubtitle"><small>Periodentracker<!-- •--><br>lokal auf deinem Gerät</small>small></div>
        </div>
      </div>

      <!-- Desktop navigation (Text-Tabs + optional icon) -->
      <nav class="nav navDesktop" aria-label="Navigation">
        <button class="btn tabBtn" data-view="today"><img class="tabIcon" src="Home.png" alt="" aria-hidden="true" />Heute</button>
        <button class="btn tabBtn" data-view="calendar"><img class="tabIcon" src="Kalender.png" alt="" aria-hidden="true" />Kalender</button>
        <button class="btn tabBtn" data-view="hormones"><img class="tabIcon" src="Kurve.png" alt="" aria-hidden="true" />Hormonkurve</button>
        <button class="btn tabBtn" data-view="stats"><img class="tabIcon" src="Stats.png" alt="" aria-hidden="true" />Statistiken</button>
        <button class="btn tabBtn" data-view="settings"><img class="tabIcon" src="Einst.png" alt="" aria-hidden="true" />Einstellungen</button>
      </nav>
    </div>

    <!-- Row 2: Mobile navigation (Icons + tiny labels) -->
    <nav class="navMobile" aria-label="Navigation (mobil)">
      <button class="mTab" type="button" data-view="today" aria-label="Heute">
        <img src="Home.png" alt="" aria-hidden="true" />
        <span>Heute</span>
      </button>
      <button class="mTab" type="button" data-view="calendar" aria-label="Kalender">
        <img src="Kalender.png" alt="" aria-hidden="true" />
        <span>Kal.</span>
      </button>
      <button class="mTab" type="button" data-view="hormones" aria-label="Hormonkurve">
        <img src="Kurve.png" alt="" aria-hidden="true" />
        <span>Kurve</span>
      </button>
      <button class="mTab" type="button" data-view="stats" aria-label="Statistiken">
        <img src="Stats.png" alt="" aria-hidden="true" />
        <span>Stats</span>
      </button>
      <button class="mTab" type="button" data-view="settings" aria-label="Einstellungen">
        <img src="Einst.png" alt="" aria-hidden="true" />
        <span>Einst.</span>
      </button>
    </nav>
  </header>

  <main class="container app">
    <!-- TODAY / QUICK LOG -->
    <section class="card view" id="view-today">
      <h2>Heute</h2>
      <p class="muted introMuted">Schnell-Logging: „Heute Blutung“. Du kannst auch rückwirkend eintragen – oder direkt einen Zeitraum setzen.</p>
          <div class="cycleProgressBadge" id="cycleProgressBadge">ZT –</div>
        </div>

        <div class="cycleProgressTrackWrap" aria-label="Zyklus Fortschritt">
          <div class="cycleProgressTrack" id="cycleProgressTrack">
            <div class="cycleProgressFill" id="cycleProgressFill"></div>

            <!-- Goldener Stern: Eisprung -->
            <div class="cycleMarker ovu" id="cycleMarkerOvu" aria-label="Eisprung (≈)">
              <span class="star">★</span>
            </div>

            <!-- Sternschnuppe: Heute -->
            <div class="cycleMarker today" id="cycleMarkerToday" aria-label="Heute">
              <span class="meteor">✦</span>
              <span class="tail" aria-hidden="true"></span>
            </div>
          </div>
        </div>

        <div class="cycleProgressDates" id="cycleProgressDates">
          <div class="cpDate left">
            <div class="muted">Zyklusstart</div>
            <div class="strong" id="cycleProgressStartDate">–</div>
          </div>

          <div class="cpDate ov" id="cycleProgressOvuWrap">
            <div class="muted">Eisprung (≈)</div>
            <div class="strong" id="cycleProgressOvuDate">–</div>
          </div>

          <div class="cpDate right">
            <div class="muted">Nächster Zyklus</div>
            <div class="strong" id="cycleProgressNextStart">–</div>
          </div>
        </div>
      </div>

      

      <div class="grid2">
        <button class="btn primary" id="bleedTodayBtn" type="button">Heute Blutung: hinzufügen</button>

        <div class="card inner">
          <div class="muted">Rückwirkend (ein Tag pro Eintrag)</div>
          <div class="grid2" style="margin-top:8px;">
            <input type="date" id="bleedDate" />
            <button class="btn" id="bleedAddBtn" type="button">Blutung eintragen</button>
          </div>
          <div class="muted" style="font-size:12px;margin-top:6px;">
            Tipp: Wenn du z. B. am 18. und 21. einträgst, werden fehlende Tage dazwischen automatisch ergänzt.
          </div>
        </div>
      

      <!-- Zyklus-Timeline (Sternschnuppe) -->
      <div class="card inner cycleProgressCard hidden" id="cycleProgressCard" aria-live="polite">
        <div class="cycleProgressTop">
          <div style="flex:1;min-width:0;">
            <div class="muted" id="cycleProgressKicker">Zyklus</div>
            <div class="strong" id="cycleProgressHeadline">–</div>
            <div class="muted" style="font-size:12px;margin-top:4px;" id="cycleProgressSub">–</div>
          </div>

      </div>

      <div class="split" style="margin-top:12px;">
        <div class="card inner">
          <div class="strong">Zeitraum eintragen</div>
          <div class="muted" style="margin-top:4px;font-size:12px;">Für alte Einträge: „von–bis“ statt jeden Tag einzeln.</div>
          <div class="grid3" style="margin-top:10px;">
            <label>Von
              <input type="date" id="bleedFrom" />
            </label>
            <label>Bis
              <input type="date" id="bleedTo" />
            </label>
            <button class="btn" id="bleedAddRangeBtn" type="button" style="align-self:end;">Zeitraum speichern</button>
          </div>
          <div class="muted" style="margin-top:8px;font-size:12px;">Du kannst Zeiträume später bearbeiten oder löschen (siehe Liste unten).</div>
        </div>

        <div class="card inner hidden" id="editPeriodBox" aria-live="polite">
          <div class="strong">Periode bearbeiten</div>
          <div class="muted" style="margin-top:4px;font-size:12px;">Ändert die Blutungstage dieser Periode.</div>
          <div class="grid3" style="margin-top:10px;">
            <label>Von
              <input type="date" id="editFrom" />
            </label>
            <label>Bis
              <input type="date" id="editTo" />
            </label>
            <div class="rowBtns" style="align-self:end;justify-content:flex-end;">
              <button class="btn primary" id="editSaveBtn" type="button">Speichern</button>
              <button class="btn" id="editCancelBtn" type="button">Abbrechen</button>
            </div>
          </div>
        </div>
      </div>

		<div class="card inner" id="phasePanel" style="margin-top:10px;">
        <div class="row" style="background:transparent;border:none;padding:0;gap:12px;align-items:flex-start;">
          <div style="flex:1;">
            <div class="muted">Zyklus-Info (≈)</div>
            <div class="strong" id="phaseTitle">–</div>
            <div class="muted" style="font-size:12px;margin-top:4px;" id="phaseMeta">–</div>
          </div>
          <div class="badges" style="justify-content:flex-end;">
            <span class="badge" id="phaseBadge">–</span>
          </div>
        </div>
        <div id="phaseMini" class="phaseMini" style="margin-top:10px;"></div>
        <div class="rowBtns" style="margin-top:10px;justify-content:flex-end;">
          <button class="btn" id="phaseMoreBtn" type="button">Details & Erklärungen in der Hormonkurve →</button>
        </div>
        <div class="muted" style="margin-top:8px;font-size:12px;">
          Hinweise sind alltagstauglich & neutral formuliert (keine medizinische Beratung).
        </div>
      </div>

      <h3 style="margin-top:14px;">Letzte Perioden (aus Blutungstagen)</h3>
      <div id="periodsList" class="list"></div>



      <div class="muted" style="margin-top:12px;font-size:12px;">
        Hinweis: Notizen (LH, Schmerz etc.) kannst du pro Tag im Kalender hinzufügen.
      </div>
    </section>

    <!-- CALENDAR -->
    <section class="card view hidden" id="view-calendar">
      <div class="monthbar">
        <button class="btn monthNavBtn" id="prevBtn" type="button" aria-label="Vorheriger Monat">‹</button>
        <h2 id="monthTitle" class="center"></h2>
        <div class="monthbarRight">
          <button class="btn monthTodayBtn" id="monthTodayBtn" type="button" title="Zurück zum aktuellen Monat">Heute</button>
          <button class="btn" id="shareSummaryBtn" type="button" title="Zusammenfassung als Bild teilen">Teilen</button>
          <button class="btn monthNavBtn" id="nextBtn" type="button" aria-label="Nächster Monat">›</button>
        </div>
      </div>

      <div class="legend">
        <span class="pill period">Periode</span>
        <span class="pill fertile">Fruchtbar (≈)</span>
        <span class="pill ovu">Eisprung (≈)</span>
        <span class="pill predicted">Nächste Perioden (≈, 12 Zyklen)</span>
        <span class="pill notes">Notiz</span>
      </div>

      <div class="calendar" id="calendar"></div>
      <div class="summary" id="summary"></div>
    </section>

    <!-- HORMONE CURVE -->
    <section class="card view hidden" id="view-hormones">
      <div class="monthbar" style="margin-bottom:12px;">
        <h2 class="center" style="grid-column:1/-1;">Hormonkurve (Referenzmodell)</h2>
      </div>

      <p class="muted" style="margin-top:-4px;">
        Diese Kurven sind <span class="strong">modellierte, relative Verläufe</span> über deinen aktuellen Zyklus (keine Messung, keine medizinische Aussage).
        Sie dienen nur als Orientierung.
      </p>

      <div class="card inner" style="margin-top:10px;">
        <div class="row" style="background:transparent;border:none;padding:0;align-items:center;">
          <div style="flex:1;">
            <div class="muted">Aktueller Zyklus</div>
            <div class="strong" id="hormoneCycleLabel">–</div>
            <div class="muted" style="font-size:12px;margin-top:4px;" id="hormoneMeta">–</div>
          </div>
          <div class="badges" style="justify-content:flex-end;">
            <span class="badge"><span class="dot dot-e"></span>Östrogen</span>
            <span class="badge"><span class="dot dot-lh"></span>LH</span>
            <span class="badge"><span class="dot dot-p"></span>Progesteron</span>
            <span class="badge"><span class="dot dot-bbt"></span>Basaltemp (opt.)</span>
          </div>
        </div>

        <div class="chartWrap">
          <canvas id="hormoneChart" width="980" height="420" aria-label="Hormonkurven"></canvas>
        </div>

        <div class="muted" style="margin-top:10px;font-size:12px;">
          Markierungen: <span class="strong">Heute</span> (Linie) und <span class="strong">geschätzter Eisprung</span> (Linie).
          Werte sind 0–1 skaliert (relativ).
        </div>
      </div>

      <div class="card inner hormoneDetails" id="hormoneDetails" style="margin-top:12px;">
        <div class="row" style="background:transparent;border:none;padding:0;align-items:flex-start;gap:12px;">
          <div style="flex:1;">
            <div class="muted">Heute: Mini-Übersicht</div>
            <div class="strong" id="hormoneDetailsTitle">–</div>
            <div class="muted" style="font-size:12px;margin-top:4px;" id="hormoneDetailsMeta">Tippe auf eine Kategorie, um mehr zu lesen.</div>
            <div class="hExplain" id="hormoneExplain" style="margin-top:10px;"></div>
          </div>
        </div>
        <div id="hormoneDetailsBody" class="hormoneDetailsBody" style="margin-top:10px;"></div>
      </div>
    </section>

    <!-- STATS -->
    <section class="card view hidden" id="view-stats">
      <h2>Statistiken</h2>
      <div id="statsSummary"></div>

      <h3 style="margin-top:14px;">Letzte 12 Zyklen inkl. Eisprung-Zyklustag</h3>
      <div id="last12"></div>

      

      <h3 style="margin-top:14px;">Visualisierungen</h3>
      <div id="statsCharts"></div>
<p class="muted" style="margin-top:12px;">
        Hinweis: Eisprung/Fruchtbarkeit sind Näherungen. LH-positiv wird berücksichtigt (Eisprung ≈ LH+1 Tag).
      </p>
    </section>

    <!-- SETTINGS -->
    <section class="card view hidden" id="view-settings">
      <h2>Einstellungen</h2>
      <p class="muted">Diese Werte werden als Standard genutzt (du musst nicht jedes Mal Zykluslänge angeben).</p>

      <!-- iPhone/Safari: gentle backup reminder (Files app) -->
      <div id="iosBackupHint" class="card inner hidden" aria-live="polite"></div>

      <form id="settingsForm" class="form">
        <div class="grid2">
          <label>Standard Zykluslänge (Tage)
            <input type="number" id="setCycleLen" min="15" max="60" value="28" />
          </label>
          <label>Standard Periodenlänge (Tage)
            <input type="number" id="setPeriodLen" min="1" max="14" value="5" />
          </label>
        </div>

        <label>Standard Eisprungtag (Zyklustag, optional)
          <input type="number" id="setOvuDay" min="6" max="50" placeholder="z. B. 23" />
        </label>

        <label class="inlineCheck">
          <input type="checkbox" id="setTtc" />
          Kinderwunsch aktiv (zeigt ET-/Sternzeichen-Infos & nimmt sie beim Teilen mit)
        </label>

        <label>Warnungen erneut zeigen nach (Monate)
          <input type="number" id="setWarnSnoozeMonths" min="1" max="24" value="6" />
        </label>
		
		
        <div class="grid2">
          <label>Mutter Sternzeichen (optional)
            <select id="setMotherSign">
              <option value="">–</option>
              <option value="Widder">Widder</option>
              <option value="Stier">Stier</option>
              <option value="Zwillinge">Zwillinge</option>
              <option value="Krebs">Krebs</option>
              <option value="Löwe">Löwe</option>
              <option value="Jungfrau">Jungfrau</option>
              <option value="Waage">Waage</option>
              <option value="Skorpion">Skorpion</option>
              <option value="Schütze">Schütze</option>
              <option value="Steinbock">Steinbock</option>
              <option value="Wassermann">Wassermann</option>
              <option value="Fische">Fische</option>
            </select>
          </label>
          <label>Vater Sternzeichen (optional)
            <select id="setFatherSign">
              <option value="">–</option>
              <option value="Widder">Widder</option>
              <option value="Stier">Stier</option>
              <option value="Zwillinge">Zwillinge</option>
              <option value="Krebs">Krebs</option>
              <option value="Löwe">Löwe</option>
              <option value="Jungfrau">Jungfrau</option>
              <option value="Waage">Waage</option>
              <option value="Skorpion">Skorpion</option>
              <option value="Schütze">Schütze</option>
              <option value="Steinbock">Steinbock</option>
              <option value="Wassermann">Wassermann</option>
              <option value="Fische">Fische</option>
            </select>
          </label>
        </div>

        <div class="grid2">
          <button class="btn primary" type="submit">Speichern</button>
          <button class="btn danger" type="button" id="resetDataBtn">Alle Daten löschen</button>
        </div>
      </form>

      <div class="card inner" style="margin-top:12px;">
        <div class="strong">Daten (CSV)</div>
        <p class="muted" style="margin:6px 0 10px;font-size:12px;">
          Export/Import umfasst Blutungstage, Notizen und Einstellungen.
        </p>

        <div class="grid2">
          <button class="btn" type="button" id="exportCsvBtn">CSV exportieren</button>
          <label style="gap:6px;">
            <span class="muted" style="font-size:12px;">CSV importieren</span>
            <input type="file" id="importCsvFile" accept=".csv,text/csv" />
          </label>
        </div>

        <label class="inlineCheck">
          <input type="checkbox" id="importReplace" />
          Beim Import vorhandene Daten ersetzen (statt zusammenführen)
        </label>

        <div class="muted" style="margin-top:8px;font-size:12px;">
          Tipp: Wenn du nur sichern willst, nutze Export. Beim Import werden doppelte IDs automatisch übersprungen.
        </div>
      </div>

      <div class="card inner" style="margin-top:12px;">
        <div class="strong">Auto-Backup (Datei)</div>
        <p class="muted" style="margin:6px 0 10px;font-size:12px;">
          Sichert deine Daten als <span class="strong">Datei außerhalb des Browsers</span> (Standardname: <span class="strong">lunacy-backup.json</span>).
          In Chrome/Edge wird die Datei automatisch überschrieben. Auf iPhone/Safari nutzt du „In Dateien sichern“.
        </p>

        <div class="grid2">
          <button class="btn primary" type="button" id="backupEnableBtn">Auto-Backup aktivieren</button>
          <button class="btn" type="button" id="backupNowBtn">Backup jetzt schreiben</button>
        </div>

        <div class="grid2" style="margin-top:10px;">
          <button class="btn" type="button" id="backupShareBtn">iPhone: In Dateien sichern</button>
          <button class="btn danger" type="button" id="backupDisableBtn">Deaktivieren</button>
        </div>

        <div class="muted" id="backupStatus" style="margin-top:10px;font-size:12px;">Status: –</div>

        <div class="muted" style="margin-top:8px;font-size:12px;">
          Tipp iPhone: Speichere in „Dateien“ (z. B. iCloud Drive) und überschreibe die Datei bei Bedarf. Import geht unten.
        </div>
      </div>

      <div class="card inner" style="margin-top:12px;">
        <div class="strong">Backup importieren (JSON)</div>
        <p class="muted" style="margin:6px 0 10px;font-size:12px;">
          Importiert eine zuvor gesicherte <span class="strong">lunacy-backup.json</span>.
        </p>
        <div class="grid2">
          <label style="gap:6px;">
            <span class="muted" style="font-size:12px;">Backup-Datei auswählen</span>
            <input type="file" id="importBackupFile" accept="application/json,.json" />
          </label>
          <label class="inlineCheck" style="align-items:center;">
            <input type="checkbox" id="importBackupReplace" />
            Beim Import vorhandene Daten ersetzen
          </label>
        </div>
      </div>

      <div class="card inner" style="margin-top:12px;">
        <div class="strong">Google/Apple Kalender (ICS)</div>
        <p class="muted" style="margin:6px 0 10px;font-size:12px;">
          Exportiert <span class="strong">Prognose</span> als <span class="strong">private Ganztags-Termine</span>: Periode (≈) und fruchtbare Tage (≈, Block).
        </p>
        <div class="grid2">
          <button class="btn primary" type="button" id="exportIcsBtn">ICS exportieren</button>
          <button class="btn" type="button" id="exportIcsInfoBtn" title="Hinweise">Hinweis</button>
        </div>
        <div class="muted" style="margin-top:8px;font-size:12px;">
          Zeitraum: nächste 12 Monate. Import in Google Kalender: Einstellungen → Importieren → .ics wählen.
        </div>
      </div>
      <div class="muted" style="margin-top:12px;font-size:12px;">
        „Eisprungtag“ wird nur genutzt, wenn noch keine LH-positiv Daten vorhanden sind.
      </div>
    </section>
  </main>

  <footer class="footer">
    <small class="muted">Datenschutz: Daten bleiben auf deinem Gerät. Keine Cloud, kein Account.</small>
  </footer>

  <!-- Notes Modal -->
  <div id="notesModal" class="modal hidden" aria-hidden="true">
    <div class="modalBackdrop" data-close="1"></div>
    <div class="modalCard" role="dialog" aria-modal="true">
      <div class="modalHeader">
        <div>
          <div class="muted">Notizen</div>
          <div class="strong" id="notesTitle">Datum</div>
        </div>
        <button class="btn" id="notesClose" type="button">✕</button>
      </div>

      <div id="notesList" class="list" style="margin:10px 0 12px;"></div>

      <div class="card inner" style="margin:0;">
        <div class="strong" style="margin-bottom:8px;">Neue Notiz</div>
        <form id="noteForm" class="form">
          <label>Typ
            <select id="noteType" class="select">
              <option value="LH">LH-Test</option>
              <option value="HCG">Schwangerschaftstest</option>
              <option value="MITTELSCHMERZ">Mittelschmerz</option>
              <option value="ZERVIX">Zervixschleim</option>
              <option value="SCHMERZ">Schmerz</option>
              <option value="SYMPTOM">Symptom / Notiz</option>
            </select>
          </label>

          <div class="grid2">
            <label>Ergebnis (optional)
              <select id="noteResult" class="select">
                <option value="">–</option>
                <option value="negativ">negativ</option>
                <option value="positiv">positiv</option>
                <option value="unsicher">unsicher</option>
                <option value="fadenziehend">fadenziehend</option>
              </select>
            </label>
            <label>Seite (optional)
              <select id="noteSide" class="select">
                <option value="">–</option>
                <option value="links">links</option>
                <option value="rechts">rechts</option>
                <option value="beidseitig">beidseitig</option>
              </select>
            </label>
          </div>

          <label>Intensität 0–10 (optional)
            <input id="noteIntensity" type="number" min="0" max="10" value="0" />
          </label>

          <label>Text (optional)
            <textarea id="noteText" rows="3" placeholder="z. B. Symptome, Stimmung, Temperatur..."></textarea>
          </label>

          <div class="grid2">
            <button class="btn primary" type="submit">Notiz speichern</button>
            <button class="btn" type="button" id="noteClearBtn">Eingaben leeren</button>
          </div>
        </form>
      </div>

      <div class="muted" style="margin-top:10px;font-size:12px;">
        LH-positiv beeinflusst die Eisprung-Schätzung (≈ +1 Tag) und wird für künftige Prognosen gelernt.
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="utils.js"></script>
  <script src="astro.js"></script>
  <script src="backup.js"></script>
  <script src="app.js"></script>
  <script src="stats_charts.js"></script>
  <script src="icsExport.js"></script>
  <script src="mittelschmerz_stats.js"></script>
  <script src="warnings.js"></script>
  <script src="tips.js"></script>
  <script src="cycleProgress.js"></script>
</body>
</html>
